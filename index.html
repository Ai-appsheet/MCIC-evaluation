<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCIC-Evaluation</title>
    
    <link rel="icon" type="image/png" href="https://img5.pic.in.th/file/secure-sv1/-72f36e2606e6a703c.png">
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    
    <style>
        :root {
            --primary-color: #007bff;
            --light-gray: #f8f9fa;
            --border-color: #dee2e6;
            --section-bg: #f1f5f9;
        }
        body { font-family: 'Sarabun', sans-serif; background-color: var(--light-gray); }
        .container { max-width: 800px; }
        .form-container { background-color: white; padding: 2.5rem; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); margin-top: 2rem; border-top: 5px solid var(--primary-color); }
        
        /* ======================= 2. เพิ่มโค้ด CSS สำหรับโลโก้ ======================= */
        .logo-container {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .logo-img {
            max-width: 150px; /* ปรับขนาดโลโก้ได้ตามต้องการ */
            height: auto;
        }

        .form-title { text-align: center; font-weight: 700; margin-bottom: 2rem; color: #333; }
        .section-title { font-weight: 700; background-color: var(--section-bg); padding: 0.75rem 1.25rem; border-radius: 8px; margin-top: 2.5rem; border-left: 4px solid var(--primary-color); }
        label { margin-bottom: 0.5rem; font-weight: 500; color: #555; }
        .form-control[readonly] { background-color: #f7f7f7; border: 1px solid var(--border-color); font-weight: 600; }
        .user-info-card { background-color: #fafafa; border: 1px solid #e9ecef; border-radius: 8px; }

        .rating-grid { margin-top: 1rem; border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; }
        .rating-header, .rating-row { display: flex; align-items: center; }
        .rating-header { background-color: var(--section-bg); font-weight: bold; color: #495057; text-align: center; }
        .rating-row { border-top: 1px solid var(--border-color); }
        .rating-question { flex: 1; padding: 1rem 1.25rem; }
        .rating-options { display: flex; width: 240px; text-align: center; }
        .rating-options .col { padding: 1rem 0; display: flex; justify-content: center; align-items: center; }
        .rating-header .rating-options .col { padding: 0.75rem 0; }
        .rating-options .col + .col { border-left: 1px solid var(--border-color); }
        .rating-options input[type="radio"] { transform: scale(1.4); cursor: pointer; }
        
        .final-score-container { background-color: var(--section-bg); padding: 1.5rem; border-radius: 8px; margin-top: 2.5rem; text-align: center; }
        .final-score-label { font-size: 1.2rem; font-weight: bold; }
        .final-score-value { font-size: 3rem; font-weight: 700; color: var(--primary-color); line-height: 1.1; }
        .btn-primary { background-color: var(--primary-color); border: none; padding: 12px 30px; font-weight: bold; border-radius: 50px; transition: all 0.2s ease-in-out; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3); }

        .mobile-rating-label { display: none; }

        @media (max-width: 576px) {
            .form-container { padding: 1.5rem; }
            .rating-header { display: none; }
            .rating-row { flex-direction: column; align-items: flex-start; padding-bottom: 1rem;}
            .rating-question { padding-bottom: 0.75rem; }
            .rating-options { width: 100%; border-top: 1px solid #f0f0f0; padding-top: 1rem; }
            .rating-options .col { flex-direction: column; }
            .rating-options .col + .col { border-left: 1px solid var(--border-color); }
            .mobile-rating-label { display: block; font-size: 0.75rem; margin-top: 0.25rem; color: #6c757d; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="form-container">

        <div class="logo-container">
            <img src="https://img2.pic.in.th/pic/modern-cass-international-cosmetic-vietnam_400x400_341568856.png" alt="Company Logo" class="logo-img">
        </div>

        <h3 class="form-title">Performance evaluation form<br><small>แบบฟอร์มประเมินผลการจัดกิจกรรม WORKSHOP</small></h3>

        <form method="post" autocomplete="off" name="evaluation-sheet" id="evaluationForm">
            <input type="hidden" name="formType" value="evaluation">
            <input type="hidden" name="userID" id="userID">
            <input type="hidden" id="memo" name="Memo">

            <div id="userInfoSection">
                <h5 class="section-title">ข้อมูลผู้ประเมิน</h5>
                <div class="alert alert-info mt-3" id="loading-alert">กำลังตรวจสอบข้อมูลการลงทะเบียน...</div>
                
                <div class="card p-3 mt-3 user-info-card">
                    <div class="row">
                        <div class="form-group col-md-4"><label for="fullName">ชื่อ-สกุล</label><input type="text" class="form-control" id="fullName" name="ชื่อ-สกุล" required readonly></div>
                        <div class="form-group col-md-4"><label for="phone">เบอร์โทร</label><input type="text" class="form-control" id="phone" name="เบอร์โทร" required readonly></div>
                        <div class="form-group col-md-4"><label for="shopName">ชื่อร้าน</label><input type="text" class="form-control" id="shopName" name="ชื่อร้าน" required readonly></div>
                    </div>
                    <div class="row mt-2">
                        <div class="form-group col-md-4"><label for="province">จังหวัด</label><input type="text" class="form-control" id="province" name="จังหวัด" required readonly></div>
                        <div class="form-group col-md-4"><label for="status">สถานะ</label><input type="text" class="form-control" id="status" name="สถานะ" required readonly></div>
                        <div class="form-group col-md-4"><label for="eventLocation">สถานที่จัดงาน</label><input type="text" class="form-control" id="eventLocation" name="สถานที่จัดงาน" required readonly></div>
                    </div>
                </div>
            </div>
            
            <div id="evaluationQuestions">
                <h5 class="section-title">1. ความพร้อมของการเข้าร่วมงาน WORKSHOP</h5>
                <div class="rating-grid">
                    <div class="rating-header">
                        <div class="rating-question"></div>
                        <div class="rating-options">
                            <div class="col">มากที่สุด (5)</div>
                            <div class="col">ปานกลาง (3)</div>
                            <div class="col">น้อยที่สุด (1)</div>
                        </div>
                    </div>
                    <div class="rating-row">
                        <div class="rating-question">1.1 ระยะเวลาที่ได้รับการติดต่อ / โทรศัพท์เชิญ / ข่าวสารให้มาร่วมงาน</div>
                        <div class="rating-options">
                            <div class="col"><input type="radio" name="q1_1" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q1_1" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q1_1" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                </div>

                <h5 class="section-title">2. ความพร้อมสถานที่จัดงาน</h5>
                <div class="rating-grid">
                    <div class="rating-row">
                        <div class="rating-question">2.1 ความพร้อม โต๊ะ เก้าอี้ ห้องจัดคารอบรม</div>
                        <div class="rating-options">
                            <div class="col"><input type="radio" name="q2_1" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q2_1" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q2_1" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                    <div class="rating-row">
                        <div class="rating-question">2.2 ความพร้อม เครื่องฉายโปรเจคเตอร์ / ไมค์ / สายไฟ</div>
                        <div class="rating-options">
                           <div class="col"><input type="radio" name="q2_2" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q2_2" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q2_2" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                    <div class="rating-row">
                        <div class="rating-question">2.3 ความพร้อม การลงทะเบียน</div>
                        <div class="rating-options">
                            <div class="col"><input type="radio" name="q2_3" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q2_3" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q2_3" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                </div>

                <h5 class="section-title">3. เทคนิคการนำเสนอของวิทยากร การสอนสด</h5>
                 <div class="rating-grid">
                     <div class="rating-row">
                        <div class="rating-question">3.1 เทคนิคดีดี วิทยากรนำเสนอเนื้อหาสาระครบถ้วนและน่าสนใจ</div>
                        <div class="rating-options">
                            <div class="col"><input type="radio" name="q3_1" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q3_1" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q3_1" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                    <div class="rating-row">
                        <div class="rating-question">3.2 เอกสารประกอบการสอนของวิทยากร สื่อสิ่งพิมพ์ / สื่อโซเชียล</div>
                        <div class="rating-options">
                             <div class="col"><input type="radio" name="q3_2" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q3_2" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q3_2" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                     <div class="rating-row">
                        <div class="rating-question">3.3 การบริหารเวลาของวิทยากรในการสอน</div>
                        <div class="rating-options">
                           <div class="col"><input type="radio" name="q3_3" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q3_3" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q3_3" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                     <div class="rating-row">
                        <div class="rating-question">3.4 วิทยากรสาธิต ผลลัพธ์ของสีได้ตรงกับความต้องการ</div>
                        <div class="rating-options">
                            <div class="col"><input type="radio" name="q3_4" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q3_4" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q3_4" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                     <div class="rating-row">
                        <div class="rating-question">3.5 เทคนิคที่วิทยากรสอน สามารถนำไปใช้ได้จริง</div>
                        <div class="rating-options">
                            <div class="col"><input type="radio" name="q3_5" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q3_5" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q3_5" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                     <div class="rating-row">
                        <div class="rating-question">3.6 ความน่าเชื่อถือของวิทยากรในการสอนสี</div>
                        <div class="rating-options">
                             <div class="col"><input type="radio" name="q3_6" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q3_6" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q3_6" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                </div>

                <h5 class="section-title">4. เทคนิคการสอนของวิทยากร การสอนตัด โดยไม่ใช้เครื่องตัด</h5>
                <div class="rating-grid">
                     <div class="rating-row">
                        <div class="rating-question">4.1 การวิเคราะห์เส้นผมก่อน ตัดซอย โดยไม่ใช้เครื่องตัด</div>
                        <div class="rating-options">
                            <div class="col"><input type="radio" name="q4_1" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q4_1" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q4_1" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                    <div class="rating-row">
                        <div class="rating-question">4.2 ผลลัพธ์ของงานตัดโดยไม่ใช้เครื่อง ได้ตรงกับความต้องการ</div>
                        <div class="rating-options">
                            <div class="col"><input type="radio" name="q4_2" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q4_2" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q4_2" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                     <div class="rating-row">
                        <div class="rating-question">4.3 เทคนิคที่วิทยากรสอน สามารถนำไปใช้ได้จริง</div>
                        <div class="rating-options">
                            <div class="col"><input type="radio" name="q4_3" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q4_3" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q4_3" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                     <div class="rating-row">
                        <div class="rating-question">4.4 ความน่าเชื่อถือของวิทยากรในการสอนตัดโดยไม่ใช้เครื่อง</div>
                        <div class="rating-options">
                            <div class="col"><input type="radio" name="q4_4" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q4_4" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q4_4" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                    <div class="rating-row">
                        <div class="rating-question">4.5 เห็นเทคนิคการใช้อุปกรณ์ไฟฟ้า เช่น กรรไกร</div>
                        <div class="rating-options">
                            <div class="col"><input type="radio" name="q4_5" value="5" required><span class="mobile-rating-label">มากที่สุด (5)</span></div>
                            <div class="col"><input type="radio" name="q4_5" value="3"><span class="mobile-rating-label">ปานกลาง (3)</span></div>
                            <div class="col"><input type="radio" name="q4_5" value="1"><span class="mobile-rating-label">น้อยที่สุด (1)</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="final-score-container">
                    <div class="final-score-label">คะแนนรวมสุทธิ</div>
                    <div class="final-score-value" id="finalScoreDisplay">0</div>
                    <small class="text-muted">*คะแนนเต็ม 75 คะแนน</small>
                    <input type="hidden" name="คะแนนรวมสุทธิ" id="hiddenFinalScore">
                </div>
                
                <h5 class="section-title">5. ความคิดเห็นเพิ่มเติม</h5>
                 <div class="form-group mt-3">
                    <label>หากมีการจัดงานครั้งถัดไป ท่านจะมาอีกหรือไม่</label>
                    <div class="text-center bg-light p-2 rounded">
                        <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="come_again" id="come_yes" value="มา" required><label class="form-check-label" for="come_yes">มา</label></div>
                        <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="come_again" id="come_no" value="ไม่มา"><label class="form-check-label" for="come_no">ไม่มา</label></div>
                    </div>
                </div>
                <div class="form-group"><label for="reason">เหตุผล (ถ้ามี)</label><textarea class="form-control" id="reason" name="เหตุผล" rows="2"></textarea></div>
                <div class="form-group"><label for="suggestion">ข้อเสนอแนะและความคิดเห็นเพิ่มเติม</label><textarea class="form-control" id="suggestion" name="ข้อเสนอแนะ" rows="3"></textarea></div>
                
                <div class="text-center mt-4"><button type="submit" class="btn btn-primary btn-lg">ส่งแบบประเมิน</button></div>
            </div>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxRJADF6QmPQzORPN6Rfw0DkjjQhpGgJXEtbTJC3mFR2sKwZVRIscaA_nVXybivaQJh/exec'; 
    const form = document.forms['evaluation-sheet'];
    async function main() {
        await liff.init({ liffId: "2008243853-A2X0rv36" });
        if (!liff.isLoggedIn()) { liff.login(); } 
        else {
            const profile = await liff.getProfile();
            document.getElementById('userID').value = profile.userId;
            fetchUserData(profile.userId);
        }
    }
    main();
    function fetchUserData(userId) {
        const url = `${scriptURL}?action=getUserData&userId=${userId}`;
        fetch(url).then(res => res.json()).then(data => {
            const loadingAlert = document.getElementById('loading-alert');
            if (data.found) {
                $('#fullName').val(data.fullName);
                $('#phone').val(data.phone);
                $('#shopName').val(data.shopName);
                $('#province').val(data.province);
                $('#status').val(data.status);
                $('#eventLocation').val(data.eventLocation);
                $('#memo').val(data.memo);
                loadingAlert.className = 'alert alert-success';
                loadingAlert.textContent = 'พบข้อมูลการลงทะเบียนของคุณแล้ว';
            } else {
                loadingAlert.className = 'alert alert-warning';
                loadingAlert.textContent = 'ไม่พบข้อมูลการลงทะเบียน กรุณากรอกข้อมูลผู้ประเมิน';
                $('#userInfoSection input').prop('readonly', false);
            }
        }).catch(err => {
            console.error('Error fetching user data:', err);
            $('#loading-alert').className = 'alert alert-danger';
            $('#loading-alert').textContent = 'เกิดข้อผิดพลาดในการดึงข้อมูล';
        });
    }
    function calculateScore() {
        let finalScore = 0;
        $('input[type="radio"][name^="q"]:checked').each(function() {
            finalScore += parseInt($(this).val(), 10);
        });
        $('#finalScoreDisplay').text(finalScore);
        $('#hiddenFinalScore').val(finalScore);
    }
    $('input[type="radio"]').on('change', calculateScore);
    form.addEventListener('submit', e => {
        e.preventDefault();
        Swal.fire({ title: 'กำลังส่งข้อมูล...', text: 'กรุณารอสักครู่', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); } });
        fetch(scriptURL, { method: 'POST', body: new FormData(form) }).then(response => response.json()).then(data => {
            if (data.result === 'success') {
                Swal.fire({ icon: 'success', title: 'ส่งแบบประเมินสำเร็จ!', text: 'ขอบคุณสำหรับความคิดเห็นของคุณ', showConfirmButton: false, timer: 2500 })
                .then(() => { if (liff.isInClient()) { liff.closeWindow(); } });
            } else { throw new Error(data.error); }
        }).catch(error => {
            Swal.fire('เกิดข้อผิดพลาด!', `ไม่สามารถบันทึกข้อมูลได้: ${error.message}`, 'error');
        });
    });
</script>

</body>
</html>

