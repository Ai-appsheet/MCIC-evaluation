<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แบบฟอร์มประเมินผล</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f8f9fa; }
        .container { max-width: 800px; }
        .form-container { background-color: white; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-top: 2rem; }
        .form-title { text-align: center; font-weight: 700; margin-bottom: 2rem; }
        .section-title { font-weight: 600; background-color: #e9ecef; padding: 0.75rem; border-radius: 5px; margin-top: 2rem; }
        .question-row { display: flex; align-items: center; border-bottom: 1px solid #dee2e6; padding: 1rem 0; }
        .question-text { flex-grow: 1; }
        .radio-group { display: flex; justify-content: space-around; min-width: 200px; }
        .total-score-container { background-color: #f1f1f1; padding: 1rem; border-radius: 8px; }
        label { margin-bottom: 0; }
        .form-control[readonly] { background-color: #e9ecef; }
    </style>
</head>
<body>

<div class="container">
    <div class="form-container">
        <h3 class="form-title">Performance evaluation form<br><small>แบบฟอร์มประเมินผลการจัดกิจกรรม WORKSHOP</small></h3>

        <form method="post" autocomplete="off" name="evaluation-sheet" id="evaluationForm">
            <input type="hidden" name="formType" value="evaluation">
            <input type="hidden" name="userID" id="userID">

            <div id="userInfoSection">
                <h5 class="section-title">ข้อมูลผู้ประเมิน</h5>
                <div class="alert alert-info" id="loading-alert">กำลังตรวจสอบข้อมูลการลงทะเบียน...</div>
                <div class="row">
                    <div class="form-group col-md-6">
                        <label for="fullName">ชื่อ-สกุลผู้ลงทะเบียน</label>
                        <input type="text" class="form-control" id="fullName" name="ชื่อ-สกุล" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="phone">เบอร์โทร</label>
                        <input type="text" class="form-control" id="phone" name="เบอร์โทร" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="shopName">ชื่อร้านเสริมสวย/บาร์เบอร์</label>
                        <input type="text" class="form-control" id="shopName" name="ชื่อร้าน" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="province">จังหวัด</label>
                        <input type="text" class="form-control" id="province" name="จังหวัด" required>
                    </div>
                     <div class="form-group col-md-6">
                        <label for="status">สถานะ</label>
                        <input type="text" class="form-control" id="status" name="สถานะ" required>
                    </div>
                </div>
            </div>

            <div id="evaluationQuestions">
                <h5 class="section-title">1. ความพร้อมของการเข้าร่วมงาน WORKSHOP</h5>
                <div class="question-row">
                    <div class="question-text">1.1 ระยะเวลาที่ได้รับการติดต่อ / โทรศัพท์เชิญ / ข่าวสารให้มาร่วมงาน</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q1_1" value="5" required> 5</label>
                        <label><input type="radio" name="q1_1" value="3"> 3</label>
                        <label><input type="radio" name="q1_1" value="1"> 1</label>
                    </div>
                </div>
                
                <h5 class="section-title">2. ความพร้อมสถานที่จัดงาน</h5>
                <div class="question-row">
                    <div class="question-text">2.1 ความพร้อม โต๊ะ เก้าอี้ ห้องจัดคารอบรม</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q2_1" value="5" required> 5</label>
                        <label><input type="radio" name="q2_1" value="3"> 3</label>
                        <label><input type="radio" name="q2_1" value="1"> 1</label>
                    </div>
                </div>
                <div class="question-row">
                    <div class="question-text">2.2 ความพร้อม เครื่องฉายโปรเจคเตอร์ / ไมค์ / สายไฟ</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q2_2" value="5" required> 5</label>
                        <label><input type="radio" name="q2_2" value="3"> 3</label>
                        <label><input type="radio" name="q2_2" value="1"> 1</label>
                    </div>
                </div>
                <div class="question-row">
                    <div class="question-text">2.3 ความพร้อม การลงทะเบียน</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q2_3" value="5" required> 5</label>
                        <label><input type="radio" name="q2_3" value="3"> 3</label>
                        <label><input type="radio" name="q2_3" value="1"> 1</label>
                    </div>
                </div>

                <h5 class="section-title">3. เทคนิคการนำเสนอของวิทยากร การสอนสด</h5>
                 <div class="question-row">
                    <div class="question-text">3.1 เทคนิคดีดี วิทยากรนำเสนอเนื้อหาสาระครบถ้วนและน่าสนใจ</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q3_1" value="5" required> 5</label>
                        <label><input type="radio" name="q3_1" value="3"> 3</label>
                        <label><input type="radio" name="q3_1" value="1"> 1</label>
                    </div>
                </div>
                <div class="question-row">
                    <div class="question-text">3.2 เอกสารประกอบการสอนของวิทยากร สื่อสิ่งพิมพ์ / สื่อโซเชียล</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q3_2" value="5" required> 5</label>
                        <label><input type="radio" name="q3_2" value="3"> 3</label>
                        <label><input type="radio" name="q3_2" value="1"> 1</label>
                    </div>
                </div>
                <div class="question-row">
                    <div class="question-text">3.3 การบริหารเวลาของวิทยากรในการสอน</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q3_3" value="5" required> 5</label>
                        <label><input type="radio" name="q3_3" value="3"> 3</label>
                        <label><input type="radio" name="q3_3" value="1"> 1</label>
                    </div>
                </div>
                <div class="question-row">
                    <div class="question-text">3.4 วิทยากรสาธิต ผลลัพธ์ของสีได้ตรงกับความต้องการ</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q3_4" value="5" required> 5</label>
                        <label><input type="radio" name="q3_4" value="3"> 3</label>
                        <label><input type="radio" name="q3_4" value="1"> 1</label>
                    </div>
                </div>
                <div class="question-row">
                    <div class="question-text">3.5 เทคนิคที่วิทยากรสอน สามารถนำไปใช้ได้จริง</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q3_5" value="5" required> 5</label>
                        <label><input type="radio" name="q3_5" value="3"> 3</label>
                        <label><input type="radio" name="q3_5" value="1"> 1</label>
                    </div>
                </div>
                <div class="question-row">
                    <div class="question-text">3.6 ความน่าเชื่อถือของวิทยากรในการสอนสี</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q3_6" value="5" required> 5</label>
                        <label><input type="radio" name="q3_6" value="3"> 3</label>
                        <label><input type="radio" name="q3_6" value="1"> 1</label>
                    </div>
                </div>

                <h5 class="section-title">4. เทคนิคการสอนของวิทยากร การสอนตัด โดยไม่ใช้เครื่องตัด</h5>
                <div class="question-row">
                    <div class="question-text">4.1 การวิเคราะห์เส้นผมก่อน ตัดซอย โดยไม่ใช้เครื่องตัด</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q4_1" value="5" required> 5</label>
                        <label><input type="radio" name="q4_1" value="3"> 3</label>
                        <label><input type="radio" name="q4_1" value="1"> 1</label>
                    </div>
                </div>
                <div class="question-row">
                    <div class="question-text">4.2 ผลลัพธ์ของงานตัดโดยไม่ใช้เครื่อง ได้ตรงกับความต้องการ</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q4_2" value="5" required> 5</label>
                        <label><input type="radio" name="q4_2" value="3"> 3</label>
                        <label><input type="radio" name="q4_2" value="1"> 1</label>
                    </div>
                </div>
                <div class="question-row">
                    <div class="question-text">4.3 เทคนิคที่วิทยากรสอน สามารถนำไปใช้ได้จริง</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q4_3" value="5" required> 5</label>
                        <label><input type="radio" name="q4_3" value="3"> 3</label>
                        <label><input type="radio" name="q4_3" value="1"> 1</label>
                    </div>
                </div>
                <div class="question-row">
                    <div class="question-text">4.4 ความน่าเชื่อถือของวิทยากรในการสอนตัดโดยไม่ใช้เครื่อง</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q4_4" value="5" required> 5</label>
                        <label><input type="radio" name="q4_4" value="3"> 3</label>
                        <label><input type="radio" name="q4_4" value="1"> 1</label>
                    </div>
                </div>
                 <div class="question-row">
                    <div class="question-text">4.5 เห็นเทคนิคการใช้อุปกรณ์ไฟฟ้า เช่น กรรไกร</div>
                    <div class="radio-group">
                        <label><input type="radio" name="q4_5" value="5" required> 5</label>
                        <label><input type="radio" name="q4_5" value="3"> 3</label>
                        <label><input type="radio" name="q4_5" value="1"> 1</label>
                    </div>
                </div>

                <div class="mt-4 p-3 total-score-container">
                    <h5 class="text-center">*หมายเหตุ: คะแนนเต็ม 75 คะแนน</h5>
                    <div class="row text-center">
                        <div class="col">
                            <strong>มากที่สุด (5)</strong>
                            <input type="text" class="form-control text-center" id="total5" name="รวมคะแนน5" readonly>
                        </div>
                        <div class="col">
                            <strong>ปานกลาง (3)</strong>
                            <input type="text" class="form-control text-center" id="total3" name="รวมคะแนน3" readonly>
                        </div>
                        <div class="col">
                            <strong>น้อยที่สุด (1)</strong>
                            <input type="text" class="form-control text-center" id="total1" name="รวมคะแนน1" readonly>
                        </div>
                    </div>
                </div>

                <h5 class="section-title">5. หากมีการจัดงานครั้งถัดไป ท่านจะมาอีกหรือไม่</h5>
                <div class="form-group text-center">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="come_again" id="come_yes" value="มา" required>
                        <label class="form-check-label" for="come_yes">มา</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="come_again" id="come_no" value="ไม่มา">
                        <label class="form-check-label" for="come_no">ไม่มา</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="reason">เหตุผล (ถ้ามี)</label>
                    <textarea class="form-control" id="reason" name="เหตุผล" rows="2"></textarea>
                </div>

                <div class="form-group">
                    <label for="suggestion">ข้อเสนอแนะและความคิดเห็นเพิ่มเติม</label>
                    <textarea class="form-control" id="suggestion" name="ข้อเสนอแนะ" rows="3"></textarea>
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">ส่งแบบประเมิน</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    // **สำคัญ:** ใช้ URL ที่ได้จากการ Deploy ของคุณ
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyTkAc5YegxzlvBYIYscQHVVGJdx49U8puiXrAbXsZXP6sQL6vfahEQeKFMQLzNakmG/exec'; 
    const form = document.forms['evaluation-sheet'];

    async function main() {
        // **สำคัญ:** ใส่ LIFF ID ของหน้าประเมินผล
        await liff.init({ liffId: "YOUR_EVALUATION_LIFF_ID_HERE" });

        if (!liff.isLoggedIn()) {
            liff.login();
        } else {
            const profile = await liff.getProfile();
            document.getElementById('userID').value = profile.userId;
            fetchUserData(profile.userId);
        }
    }
    main();

    function fetchUserData(userId) {
        const url = `${scriptURL}?action=getUserData&userId=${userId}`;
        fetch(url)
            .then(res => res.json())
            .then(data => {
                const loadingAlert = document.getElementById('loading-alert');
                if (data.found) {
                    $('#fullName').val(data.fullName).prop('readonly', true);
                    $('#phone').val(data.phone).prop('readonly', true);
                    $('#shopName').val(data.shopName).prop('readonly', true);
                    $('#province').val(data.province).prop('readonly', true);
                    $('#status').val(data.status).prop('readonly', true);
                    loadingAlert.className = 'alert alert-success';
                    loadingAlert.textContent = 'พบข้อมูลการลงทะเบียนของคุณแล้ว';
                } else {
                    loadingAlert.className = 'alert alert-warning';
                    loadingAlert.textContent = 'ไม่พบข้อมูลการลงทะเบียน กรุณากรอกข้อมูลผู้ประเมิน';
                }
            })
            .catch(err => {
                console.error('Error fetching user data:', err);
                 $('#loading-alert').className = 'alert alert-danger';
                 $('#loading-alert').textContent = 'เกิดข้อผิดพลาดในการดึงข้อมูล';
            });
    }

    function calculateScore() {
        let total5 = 0;
        let total3 = 0;
        let total1 = 0;
        
        $('input[type="radio"]:checked').each(function() {
            const val = $(this).val();
            if (val === '5') total5++;
            else if (val === '3') total3++;
            else if (val === '1') total1++;
        });

        $('#total5').val(total5);
        $('#total3').val(total3);
        $('#total1').val(total1);
    }

    $('input[type="radio"]').on('change', calculateScore);

    form.addEventListener('submit', e => {
        e.preventDefault();
        Swal.fire({
            title: 'กำลังส่งข้อมูล...',
            text: 'กรุณารอสักครู่',
            allowOutsideClick: false,
            didOpen: () => { Swal.showLoading(); }
        });

        fetch(scriptURL, { method: 'POST', body: new FormData(form) })
            .then(response => response.json())
            .then(data => {
                if (data.result === 'success') {
                    Swal.fire({
                        icon: 'success',
                        title: 'ส่งแบบประเมินสำเร็จ!',
                        text: 'ขอบคุณสำหรับความคิดเห็นของคุณ',
                        showConfirmButton: false,
                        timer: 2500
                    }).then(() => {
                        if (liff.isInClient()) {
                            liff.closeWindow();
                        }
                    });
                } else { throw new Error(data.error); }
            })
            .catch(error => {
                Swal.fire('เกิดข้อผิดพลาด!', `ไม่สามารถบันทึกข้อมูลได้: ${error.message}`, 'error');
            });
    });
</script>

</body>

</html>
